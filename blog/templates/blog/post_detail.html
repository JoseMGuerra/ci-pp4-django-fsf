{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load cloudinary %}


{% block extra_title %} {{ page_title }} {% endblock %}

{% block content %}
        
<div class="contatiner">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div>
                <h1>Post Detail</h1>
                <h2>{{ post.title }}</h2>

                <span>By {{ post.author }} on {{ post.created_on|date:'F, m Y' }}</span><br>
                    <small class="text-muted">Last updated {{ post.updated_on | timesince }} ago
                    </small>

                    <img class="img-fluid mt-3 mb-3" src="{{ post.featured_image.url }}" alt="">
                <p>{{ post.content|safe }}</p>

            </div>
            <div>
                <strong>
                {% if user.is_authenticated %}
                    <form class="" action="{% url 'post-like' post.slug %}" method="POST">
                        {% csrf_token %}
                        {% if liked %}
                        <button type="submit" name="post_id" value="{{ post.slug }}" class="btn  btn-sm"><i class="fas fa-heart"></i></button>
                        {% else %}
                        <button type="submit" name="post_id" value="{{ post.slug }}" class="btn  btn-sm"><i class="far fa-heart"></i></button>
                        {% endif %}
                        <span class="text-secondary">
                            {{ post.number_of_likes }}  Like{{ post.number_of_likes|pluralize }}
                        </span>
                    </form>
                {% endif %}
                </strong>
            </div>

            <div class="mt-4">
                {% if request.user == post.author or user.is_superuser %}
                    <a class="btn btn-outline-primary" role="button" href="{% url 'post-update' slug=post.slug %}">Update
                    </a>
                    
                    <a class="btn btn-outline-danger" role="button" data-toggle="modal" data-target="#mymodal">Delete
                    </a>
                {% endif %}          
            </div>
        </div>

        
        <div class="modal fade" id="mymodal" data-backdrop="static"            labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Delete Post</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h4>Are you sure you want to delete this post?</h4>
                    <p>This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <a class="btn btn-outline-danger" role="button" href="{% url 'post-delete' slug=post.slug %}">Delete
                    </a>
                    <button type="button" class="btn btn-success" data-dismiss="modal">Cancel</button>
                </div>
            </div>
            </div> 
        </div> 
    </div>
</div>

<script>
    $('#myModal').modal('show') 
</script>
            

{% endblock content %}